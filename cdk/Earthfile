VERSION 0.6
FROM alpine

deps:
  FROM node:lts
  WORKDIR /workspace
  RUN npm install --location=global npm@latest
  COPY package*.json .
  RUN npm install

build:
  FROM +deps
  COPY . .
  RUN npm run build

deploy:
  FROM +build
  RUN --no-cache --secret AWS_ACCESS_KEY_ID --secret AWS_SECRET_ACCESS_KEY npm run cdk -- deploy --all

lint:
  FROM +deps
  COPY . .
  RUN npm run lint

lint.fix:
  FROM +deps
  COPY . .
  RUN npm run lint:fix
  SAVE ARTIFACT * AS LOCAL ./
